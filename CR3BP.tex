\documentclass{article}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{tikz-3dplot}
% \usepackage{esvect}
\usepackage{cancel}
\usepackage{float}
\usepackage{comment}
\usepackage[a4paper, left=3.5cm,right=3.5cm, top=3cm, bottom=3cm]{geometry}

\newcommand{\dd}[2]{\frac{\mathrm{d}#1}{\mathrm{d}#2}}
\newcommand{\vv}[1]{\boldsymbol{#1}}
\newcommand{\vh}[1]{\boldsymbol{\hat{#1}}}

\pagestyle{empty}
\begin{document}

% \section*{Diagrams}
The circular restricted three body problem (CR3BP) is a special case of the three body problem. In the CR3BP (much like in Keplerian 2-body dynamics), we neglect the mass of satellite $S$, while treating the larger celestial body $m_1$ and smaller celestial body $m_2$ as point masses. Crucially, these bodies must orbit one another in circular orbits. In other words, they both orbit about their inertially fixed barycenter $c$ \textit{at constant velocity and distance}.

\begin{figure}[H]
    \centering
    \tdplotsetmaincoords{70}{30}
    \begin{tikzpicture}[
        planet/.style = {circle, draw=black, ball color=#1, node contents={}, inner sep = 0.1cm}, 
        point/.style = {circle, draw=#1, fill=#1, node contents={}, inner sep=0.05cm},
        >=latex,
        tdplot_main_coords
        ]

        \node (B1) at (-1,0,0)     [planet=red, label=left:$m_1$];
        \node (B2) at (3,0,0)      [planet=blue, label=right:$m_2$];
        \draw[dashed, <->, lightgray] (-1,0,-1) -- (3,0,-1) node[midway, below] {$d$};
        \draw[dotted, thin, lightgray] (B1) -- ++(0,0,-1);
        \draw[dotted, thin, lightgray] (B2) -- ++(0,0,-1);
        
        \draw[dash dot, fill=none, red](0,0,0) circle (1);
        \draw[dash dot, fill=none, blue](0,0,0) circle (3);

        \draw[dashed, red] (B1) -- (0,0,0) node[midway] {$x_1$};
        \draw[dashed, blue] (0,0,0) -- (B2) node[midway] {$x_2$};
        
        \node (o) at (0,0,0)      [point=black, label=below:$c$];
        \node (r) at (1.25,2,1.25)    [point=purple, label=left:$S$];
        \draw[dashed, purple] (0,0,0) -- (0, 2, 0) node[midway, right]  {$y$} -- (1.25, 2, 0) node[midway, above]  {$x$} -- (r) node[midway, right] {$z$};

        \draw[->, gray] (0,0,0) -- (0.75,0,0) node[near end, below right] {$\vh{x}$};
        \draw[->, gray] (0,0,0) -- (0,0.75,0) node[near end, above] {$\vh{y}$};
        \draw[->, gray] (0,0,0) -- (0,0,0.75) node[near end, above left] {$\vh{z}$};

        \draw[dashed, gray] (0,0,0) -- (0,0,2);
        \draw[->, gray] (0.5,0,2) arc (0:270:0.5) node [midway, above] {$\Omega$};
    \end{tikzpicture}

    \caption{Geometry}
\end{figure}

The purple satellite is located by $\vv{r}=x\vh{x}+y\vh{y}+z\vh{z}$, and the spheres are the celestial bodies. The $xyz$ frame is not inertially stationary. Instead, they rotate with the larger bodies at a rate $\Omega$. The origin $c$ is the center of mass of $m_1$ and $m_2$ (and therefore inertially fixed). The $xy$ plane defines the plane in which $m_1$ and $m_2$ orbit, so $\vh{z}$ is defined by the direction of their angular momenta- the constant rotation at a rate $\Omega$ is a consequence of this. Note that $\vv{r}$ is not constrained to the $xy$ plane, but $m_1$ and $m_2$ definitionally are. 

\section*{Useful Relations}

We can also find a relationship between $x_1$, $x_2$, $d$, $m_1$, and $m_2$. Because $c$ is the barycenter,
\[x_1m_1=x_2m_2\]
or
\[\frac{x_1}{m_2}=\frac{x_2}{m_1}\]
We can use this to find that
\[\begin{aligned}
\frac{x_1}{x_1+x_2}&=\frac{x_1/m_2}{x_1/m_2+x_2/m_2}\\
&=\frac{x_2/m_1}{x_2/m_1+x_2/m_2}\\
&=\frac{1/m_1}{1/m_1+1/m_2}\\
&=\frac{m_2}{m_2+m_1}\\
\end{aligned}\]

Defining $d=x_1+x_2$ as the distance between the two celestial bodies, and $m=m_1+m_2$ as their total mass, we get that
\[\boxed{\frac{x_1}{d}=\frac{m_2}{m}}\]
and similarly
\[\boxed{\frac{x_2}{d}=\frac{m_1}{m}}\]


Which can be rewritten as
\[\boxed{\frac{x_1}{m_2}=\frac{x_2}{m_1}=\frac{d}{m}}\]

Lastly, we will define two additional vectors $\vv{r_1}$ and $\vv{r_2}$ which point from the first and second body respectively to the satellite.
\[\vv{r_1}=\left(x+x_1\right)\vh{x}+y\vh{y}+z\vh{z}\]
and
\[\vv{r_2}=\left(x-x_2\right)\vh{x}+y\vh{y}+z\vh{z}\]

Now we will solve for $\Omega$.
\[\begin{aligned}
    \vv{F_{\text{on2}}}&=-\frac{Gm_1m_2}{d^2}\vh{x}\\
    \cancel{m_2}\vv{a}_2^f&=-\frac{Gm_1\cancel{m_2}}{d^2}\vh{x}\\
    \dd{^f}{t}\left(\dd{^f}{t}x_2\vh{x}\right)&=-\frac{Gm_1}{d^2}\vh{x}\\
    \dd{^f}{t}\left(\cancelto{0}{\dd{^c x_2\vh{x}}{t}}+\Omega\vh{z}\times x_2\vh{x}\right)&=-\frac{Gm_1}{d^2}\vh{x}\\
    \dd{^f}{t}\Omega x_2\vh{y}&=-\frac{Gm_1}{d^2}\vh{x}\\
    \cancelto{0}{\dd{^c}{t}\Omega x_2 \vh{y}}+\Omega\vh{z}\times\Omega x_2\vh{y}&=-\frac{Gm_1}{d^2}\vh{x}\\
    -\Omega^2 x_2\vh{x}&=-\frac{Gm_1}{d^2}\vh{x}\\
    \Omega^2x_2&=\frac{Gm_1}{d^2}\\
    \Omega&=\sqrt{\frac{G}{d^2}\frac{m_1}{x_2}}\\
    \Omega&=\sqrt{\frac{Gm}{d^3}}\\
\end{aligned}\]

Defining $\mu$ conventionally as $\mu=Gm$,
\[\boxed{\Omega=\sqrt{\frac{\mu}{d^3}}}\]

\section*{Kinematics}
The transport theorem states that the inertial (fixed $f$ frame) derivative of a vector $u$ (expressed in the rotating $c$ frame) is

\[\dd{^f \vv{u}}{t}=\dd{^c\vv{u}}{t}+\vv{\omega}^{cf}\times\vv{u}\]

Where $\dd{^f}{t}$ denotes the derivative in the coordinates of the fixed frame $f$, and $\dd{^c}{t}$ denotes derivative in the coordinates of the rotating frame $c$, and $\vv{\omega}^{cf}$ denotes the angular velocity of $c$ in $f$. For this case, $\vv{\omega}^{cf}=\Omega\vh{z}$. We can find $\Omega$

For the satellite's position in the CR3BP frame $\vv{r}=x\vh{x}+y\vh{y}+z\vh{z}$, we will find the inertial acceleration to generate equations of motion.

\[
\begin{aligned}
    \vv{\dot{r}}&=\dd{^c\vv{r}}{t}+\vv{\omega}^{cf}\times\vv{r}\\
    &=\dd{^c}{t}\left(x\vh{x}+y\vh{y}+z\vh{z}\right)+\left(\Omega\vh{z}\times\left(x\vh{x}+y\vh{y}+z\vh{z}\right)\right)\\
    &=\left(\dot{x}\vh{x}+\dot{y}\vh{y}+\dot{z}\vh{z}\right)+\left(\Omega x\vh{y}-\Omega y\vh{x}\right)\\
    &=\left(\dot{x}-\Omega y\right)\vh{x}+\left(\dot{y}+\Omega x\right)\vh{y}+\dot{z}\vh{z}
\end{aligned}
\]

\[
\begin{aligned}
    \vv{\ddot{r}}&=\dot{\vv{r}}\\
    &=\dd{^c}{t}\left(\left(\dot{x}-\Omega y\right)\vh{x}+\left(\dot{y}+\Omega x\right)\vh{y}+\dot{z}\vh{z}\right)\\
        &\phantom{=}\quad+\Omega \vh{z}\times\left(\left(\dot{x}-\Omega y\right)\vh{x}+\left(\dot{y}+\Omega x\right)\vh{y}+\dot{z}\vh{z}\right)\\
    &=\left(\ddot{x}-\Omega \dot{y}\right)\vh{x}+\left(\ddot{y}+\Omega \dot{x}\right)\vh{y}+\ddot{z}\vh{z}\\
        &\phantom{=}\quad+\left(\left(\Omega\dot{x}-\Omega^2 y\right)\vh{y}-\left(\Omega\dot{y}+\Omega^2 x\right)\vh{x}\right)\\
    &=\left(\ddot{x}-2\Omega\dot{y}-\Omega^2 x\right)\vh{x} + \left(\ddot{y}+2\Omega\dot{x}-\Omega^2 y\right)\vh{y}+\ddot{z}\vh{z}\\
\end{aligned}
\]

\[\boxed{\vv{\ddot{r}}=\left(\ddot{x}-2\Omega\dot{y}-\Omega^2 x\right)\vh{x} + \left(\ddot{y}+2\Omega\dot{x}-\Omega^2 y\right)\vh{y}+\ddot{z}\vh{z}}\]

\section*{Equations of Motion}
We can now generate the equations of motion

\[\begin{aligned}
\sum_i \vv{F_i}&=m\vv{\ddot{r}}\\
\vv{F_1}+\vv{F_1}&=m\vv{\ddot{r}}\\
-\frac{\mu_1m}{r_1^3}\vv{r_1}-\frac{\mu_2m}{r_2^3}\vv{r_2}&=m\vv{\ddot{r}}\\
-\frac{\mu_1}{r_1^3}\vv{r_1}-\frac{\mu_2}{r_2^3}\vv{r_2}&=\left(\ddot{x}-2\Omega\dot{y}-\Omega^2 x\right)\vh{x} + \left(\ddot{y}+2\Omega\dot{x}-\Omega^2 y\right)\vh{y}+\ddot{z}\vh{z}
\end{aligned}\]

We now write this as three equations, one each in $x$, $y$, and $z$
\[\begin{aligned}
    -\frac{\mu_1}{r_1^3}(x+x_1)-\frac{\mu_2}{r_2^3}(x-x_2)&=\ddot{x}-2\Omega\dot{y}-\Omega^2 x\\
    -\frac{\mu_1}{r_1^3}y-\frac{\mu_2}{r_2^3}y&=\ddot{y}+2\Omega\dot{x}-\Omega^2 y\\
    -\frac{\mu_1}{r_1^3}z-\frac{\mu_2}{r_2^3}z&=\ddot{z}
\end{aligned}\]

Isolating the second derivatives,

\[\begin{aligned}
    \ddot{x}&=-\frac{\mu_1}{r_1^3}(x+x_1)-\frac{\mu_2}{r_2^3}(x-x_2)+2\Omega\dot{y}+\Omega^2 x\\
    \ddot{y}&=-\frac{\mu_1}{r_1^3}y-\frac{\mu_2}{r_2^3}y-2\Omega\dot{x}+\Omega^2 y\\
    \ddot{z}&=-\frac{\mu_1}{r_1^3}z-\frac{\mu_2}{r_2^3}z
\end{aligned}\]
    
We can now substitute $\Omega=\sqrt{\frac{\mu}{d^3}}=\sqrt{\frac{\mu_1+\mu_2}{d^3}}$

\[\boxed{\begin{aligned}
    \ddot{x}&=-\frac{\mu_1}{r_1^3}(x+x_1)-\frac{\mu_2}{r_2^3}(x-x_2)+2\sqrt{\frac{\mu}{d^3}}\dot{y}+\frac{\mu}{d^3}x\\
    \ddot{y}&=-\frac{\mu_1}{r_1^3}y-\frac{\mu_2}{r_2^3}y-2\sqrt{\frac{\mu}{d^3}}\dot{x}+\frac{\mu}{d^3}y\\
    \ddot{z}&=-\frac{\mu_1}{r_1^3}z-\frac{\mu_2}{r_2^3}z
\end{aligned}}\]

\section*{Nondimensional Equations of Motion}
We will now begin to non-dimensionalize the EOMs.

First, we will change the time unit. We will pick $t^\star=t\sqrt{\mu/d^3}$ (recall that $\sqrt{\mu/d^3}=\Omega$, which has dimensions of $\text{time}^{-1}$). Everywhere that a derivative is present, it is implied to be with respect to the time unit of 1 second. We must therefore switch from implied $\dd{}{t}$ to implied $\dd{}{t^\star}$.

\[\begin{aligned}
    \dd{(\phantom{x})}{t}&=\dd{(\phantom{x})}{t^\star}\dd{t^\star}{t}\\
    &=\dd{(\phantom{x})}{t^\star}\sqrt{\frac{\mu}{d^3}}
\end{aligned}\]

From this, it can be seen that to make a derivative with time implied to be with the nondimensional time, $\sqrt{d^3/\mu}$ must be multiplied for each derivative taken. The EOMs can now be rewritten this way, with dots implied to be relative to the nondimensional time unit

\[\begin{aligned}
    \left(\dd{^2x}{t^{\star2}}\frac{\mu}{d^3}\right)&=-\frac{\mu_1}{r_1^3}(x+x_1)-\frac{\mu_2}{r_2^3}(x-x_2)+2\sqrt{\frac{\mu}{d^3}}\left(\dd{y}{t^\star}\sqrt{\frac{\mu}{d^3}}\right)+\frac{\mu}{d^3}x\\
    \left(\dd{^2y}{t^{\star2}}\frac{\mu}{d^3}\right)&=-\frac{\mu_1}{r_1^3}y-\frac{\mu_2}{r_2^3}y-2\sqrt{\frac{\mu}{d^3}}\left(\dd{x}{t^\star}\sqrt{\frac{\mu}{d^3}}\right)+\frac{\mu}{d^3}y\\
    \left(\ddot{z}\frac{\mu}{d^3}\right)&=-\frac{\mu_1}{r_1^3}z-\frac{\mu_2}{r_2^3}z
\end{aligned}\]

Some algebraic simplifications can now be made

\[\begin{aligned}
    \dd{^2x}{t^{\star2}}&=-\frac{m_1 d^3}{m r_1^3}(x+x_1)-\frac{m_2 d^3}{m r_2^3}(x-x_2)+2\dd{y}{t^\star}+x\\
    \dd{^2y}{t^{\star2}}&=-\frac{m_1 d^3}{m r_1^3}y-\frac{m_2 d^3}{m r_2^3}y-2\dd{x}{t^\star}+y\\
    \dd{^2z}{t^{\star2}}&=-\frac{m_1 d^3}{m r_1^3}z-\frac{m_2 d^3}{m r_2^3}z
\end{aligned}\]

Next, we can define nondimensional distances and masses. The relationship between a nondimensional distance $L^\star$ and its dimensional counterpart is $L^\star=L/d$. Furthermore, we define nondimensional masses a similar relatonship $M^\star=M/m$. With this defined, we can make some substitutions in the EOMs.

\[\begin{aligned}
    \dd{^2x}{t^{\star2}}&=-\frac{m_1^\star}{r_1^{\star3}}(x+x_1)-\frac{m_2^\star}{r_2^{\star3}}(x-x_2)+2\dd{y}{t^\star}+x\\
    \dd{^2y}{t^{\star2}}&=-\frac{m_1^\star}{r_1^{\star3}}y-\frac{m_2^\star}{r_2^{\star3}}y-2\dd{x}{t^\star}+y\\
    \dd{^2z}{t^{\star2}}&=-\frac{m_1^\star}{r_1^{\star3}}z-\frac{m_2^\star}{r_2^{\star3}}z
\end{aligned}\]

By dividing both sides by $d$, the remaining distances can be made nondimensional.

\[\begin{aligned}
    \dd{^2x^\star}{t^{\star2}}&=-\frac{m_1^\star}{r_1^{\star3}}(x^\star+x_1^\star)-\frac{m_2^\star}{r_2^{\star3}}(x^\star-x_2^\star)+2\dd{y^\star}{t^\star}+x^\star\\
    \dd{^2y^\star}{t^{\star2}}&=-\frac{m_1^\star}{r_1^{\star3}}y^\star-\frac{m_2^\star}{r_2^{\star3}}y^\star-2\dd{x^\star}{t^\star}+y^\star\\
    \dd{^2z^\star}{t^{\star2}}&=-\frac{m_1^\star}{r_1^{\star3}}z^\star-\frac{m_2^\star}{r_2^{\star3}}z^\star
\end{aligned}\]

$m_2=m-m_1$, $m_2^\star=1-m_1^\star$. Similarly, $x_2^\star=1-x_1^\star$. While $r_1^\star$ and $r_2^\star$ can be written in terms of $x_1^\star$, $x^\star$, $y^\star$, and $z^\star$, I will not do this as it makes the equations much less compact and offers no benifit in computational implimentation.

\[\begin{aligned}
    \dd{^2x^\star}{t^{\star2}}&=-\frac{m_1^\star}{r_1^{\star3}}(x^\star+x_1^\star)-\frac{1-m_1^\star}{r_2^{\star3}}(x^\star-1+x_1^\star)+2\dd{y^\star}{t^\star}+x^\star\\
    \dd{^2y^\star}{t^{\star2}}&=-\frac{m_1^\star}{r_1^{\star3}}y^\star-\frac{1-m_1^\star}{r_2^{\star3}}y^\star-2\dd{x^\star}{t^\star}+y^\star\\
    \dd{^2z^\star}{t^{\star2}}&=-\frac{m_1^\star}{r_1^{\star3}}z^\star-\frac{1-m_1^\star}{r_2^{\star3}}z^\star
\end{aligned}\]

I will write this with the nondimensionalization implicit instead of explicit. In this space, all parameters represent their nondimensional counterpart.

\[\boxed{\begin{aligned}
    \ddot{x}&=-\frac{m_1}{r_1^3}(x+x_1)-\frac{1-m_1}{r_2^3}(x-1+x_1)+2\dot{y}+x\\
    \ddot{y}&=-\frac{m_1}{r_1^3}y-\frac{1-m_1}{r_2^3}y-2\dot{x}+y\\
    \ddot{z}&=-\frac{m_1}{r_1^3}z-\frac{1-m_1}{r_2^3}z
\end{aligned}}\]
The solutions to this differential equation solve the non-dimensional CR3BP, in which the bodies' masses add to 1 and the distance between them is 1. To translate it into real solutions, the time scale, distance scale, and mass scale must be applied.

\end{document}